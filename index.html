<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>WEB CRÃ‰DITO â€“ Simulador de EmprÃ©stimo</title>

<style>
body{
  margin:0;
  background:#0b1220;
  color:#e7eefc;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  min-height:100vh;
  display:flex;
  flex-direction:column;
}
.wrap{max-width:720px;margin:auto;padding:16px;flex:1}
.card{
  background:#121b2f;
  border-radius:16px;
  padding:16px;
  border:1px solid #243255;
}
.logo{text-align:center;margin-bottom:12px}
.logo h2{margin:0;font-size:26px;font-weight:900;color:#5b7cfa}
.logo span{font-size:13px;color:#b9c7ea}

label{font-size:14px;color:#b9c7ea}
input,select,button{
  width:100%;
  padding:12px;
  margin-top:6px;
  border-radius:12px;
  border:1px solid #2a3a63;
  background:#0f1730;
  color:#fff;
  font-size:16px;
}
button{background:#5b7cfa;font-weight:bold;border:none;cursor:pointer}
button:disabled{opacity:.5}
.warn{font-size:13px;color:#ffd38a;margin-top:4px}

.result{margin-top:16px;padding-top:16px;border-top:1px dashed #2a3a63}
.box{background:#0f1730;padding:12px;border-radius:12px;margin-bottom:10px}

.btn-whatsapp{
  background:#25D366;
  border:none;
  border-radius:12px;
  padding:14px;
  font-weight:bold;
  color:#fff;
  cursor:pointer;
}

footer{text-align:center;font-size:11px;color:#39ff14;padding:10px}

.overlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.loader{
  background:#121b2f;
  border-radius:16px;
  padding:20px;
  width:90%;
  max-width:420px;
  text-align:center;
}
.progress{
  width:100%;
  height:14px;
  background:#0f1730;
  border-radius:999px;
  overflow:hidden;
  margin-top:10px;
}
.progress-bar{
  height:100%;
  width:0%;
  background:#5b7cfa;
  transition:width .12s linear;
}
.progress-pct{margin-top:8px;font-weight:800}
</style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <div class="logo">
      <h2>WEB CRÃ‰DITO</h2>
      <span>Simulador de EmprÃ©stimo</span>
    </div>

    <label>ResponsÃ¡vel</label>
    <input id="responsavel" placeholder="Nome do responsÃ¡vel">

    <label>CPF</label>
    <input id="cpf" placeholder="000.000.000-00" maxlength="14">

    <label>Valor desejado (R$)</label>
    <input id="valor" inputmode="numeric" placeholder="Ex: 80">
    <div class="warn" id="info">Digite um valor vÃ¡lido</div>

    <label>Parcelas</label>
    <select id="parcelas"></select>

    <button id="btnSimular" disabled onclick="simular()">Simular</button>

    <div class="result" id="resultado" style="display:none">
      <div class="box">ðŸ’³ Valor da parcela: <strong id="parcela"></strong></div>
      <div class="box">ðŸ“Š Total a pagar: <strong id="total"></strong></div>

      <button class="btn-whatsapp" onclick="enviarWhats()">Solicitar anÃ¡lise no WhatsApp</button>
    </div>
  </div>
</div>

<footer>webdev</footer>

<div class="overlay" id="overlay">
  <div class="loader">
    Enviando solicitaÃ§Ã£oâ€¦
    <div class="progress"><div class="progress-bar" id="bar"></div></div>
    <div class="progress-pct" id="pct">0%</div>
  </div>
</div>

<script>
const WHATSAPP="5584987974972";
const LIMITE=1500;

function parseValor(v){return Number((v||"").replace(/\D/g,""))}

function formatBRL(el){
  const d=el.value.replace(/\D/g,"");
  if(!d){el.value="";return;}
  el.value=Number(d).toLocaleString("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0});
}

document.getElementById("valor").addEventListener("input",e=>{
  formatBRL(e.target);
  atualizarUI();
});

document.getElementById("cpf").addEventListener("input",e=>{
  let v=e.target.value.replace(/\D/g,"").slice(0,11);
  v=v.replace(/(\d{3})(\d)/,"$1.$2");
  v=v.replace(/(\d{3})(\d)/,"$1.$2");
  v=v.replace(/(\d{3})(\d{1,2})$/,"$1-$2");
  e.target.value=v;
});

/* ðŸ”¥ REGRAS COMPLETAS */
function regras(v){
  if(v < 100) return [
    {n:1,t:0.30},
    {n:2,t:0.26}
  ];

  if(v <= 500) return [
    {n:1,t:0.25},
    {n:2,t:0.223},
    {n:3,t:0.20},
    {n:4,t:0.195},
    {n:5,t:0.188}
  ];

  if(v <= 700) return [
    {n:6,t:0.17},
    {n:10,t:0.164}
  ];

  if(v <= 1000) return [
    {n:6,t:0.162},
    {n:12,t:0.154}
  ];

  return [
    {n:6,t:0.161},
    {n:12,t:0.154}
  ];
}

function price(p,i,n){
  return p*(i/(1-Math.pow(1+i,-n)));
}

function atualizarUI(){
  const v=parseValor(valor.value);
  parcelas.innerHTML="";
  btnSimular.disabled=true;
  if(!v||v> LIMITE) return;

  regras(v).forEach(r=>{
    const o=document.createElement("option");
    o.value=r.n;
    o.textContent=r.n+"x";
    parcelas.appendChild(o);
  });
  btnSimular.disabled=false;
}

function simular(){
  const nome=responsavel.value.trim();
  const cpfv=cpf.value.trim();
  const v=parseValor(valor.value);
  const p=Number(parcelas.value);
  if(!nome||!cpfv||!v||!p) return;

  const r=regras(v).find(x=>x.n===p);
  const parc=price(v,r.t,p);
  const tot=parc*p;

  parcela.textContent=parc.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
  total.textContent=tot.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
  resultado.style.display="block";

  window._d={nome,cpfv,v,p,parc,tot};
}

function enviarWhats(){
  const d=window._d;
  if(!d) return;

  overlay.style.display="flex";
  let prog=0;
  const t=setInterval(()=>{
    prog+=20;
    bar.style.width=prog+"%";
    pct.textContent=prog+"%";
    if(prog>=100){
      clearInterval(t);

        // Emojis por Unicode escape (nÃ£o quebram)
        const msg =
`OlÃ¡! Gostaria de solicitar uma anÃ¡lise de emprÃ©stimo.

ðŸ‘¤ ResponsÃ¡vel: ${d.nome}
ðŸªª CPF: ${d.cpf}

ðŸ’° Valor solicitado: ${d.v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}
ðŸ“† Parcelas: ${d.p}x
ðŸ’³ Valor da parcela: R$ ${d.parc.toFixed(2)}
ðŸ“Š Total a pagar: R$ ${d.tot.toFixed(2)}

Fico no aguardo, obrigado.`;

        // Redirecionamento estÃ¡vel
        window.location.href =
          "https://api.whatsapp.com/send?phone=" + WHATSAPP + "&text=" + encodeURIComponent(msg);

        overlay.style.display="none";
      }
    },80);
  }

  // init
  atualizarUI();
</script>
</body>
</html>
