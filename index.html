<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WEB CRÃ‰DITO â€“ Simulador de EmprÃ©stimo</title>

  <style>
    body {
      margin: 0;
      background: #0b1220;
      color: #e7eefc;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .wrap { max-width: 720px; margin: auto; padding: 16px; flex: 1; }
    .card {
      background: #121b2f;
      border-radius: 16px;
      padding: 16px;
      border: 1px solid #243255;
    }

    .logo { text-align: center; margin-bottom: 12px; }
    .logo h2 {
      margin: 0;
      font-size: 26px;
      font-weight: 900;
      letter-spacing: 1px;
      color: #5b7cfa;
    }
    .logo span { font-size: 13px; color: #b9c7ea; }

    label { font-size: 14px; color: #b9c7ea; }
    input, select, button {
      width: 100%;
      padding: 12px;
      margin-top: 6px;
      border-radius: 12px;
      border: 1px solid #2a3a63;
      background: #0f1730;
      color: #fff;
      font-size: 16px;
      box-sizing: border-box;
      outline: none;
    }
    input:focus, select:focus { border-color: #4c67c9; }

    button {
      background: #5b7cfa;
      font-weight: bold;
      border: none;
      cursor: pointer;
    }
    button:disabled { opacity: .5; cursor: not-allowed; }

    .warn { font-size: 13px; color: #ffd38a; margin-top: 6px; line-height: 1.25; }
    .ok { color: #8fffb3; }
    .err { color: #ff9aa5; }

    .result {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px dashed #2a3a63;
    }
    .box {
      background: #0f1730;
      padding: 12px;
      border-radius: 12px;
      margin-bottom: 10px;
    }

    .btn-whatsapp {
      background: #25D366;
      color: #fff;
      font-weight: bold;
      border: none;
      border-radius: 12px;
      padding: 14px;
      cursor: pointer;
    }

    .legal {
      margin-top: 10px;
      font-size: 12px;
      color: #9eb2e2;
      text-align: center;
      font-style: italic;
      line-height: 1.35;
    }

    footer {
      text-align: center;
      font-size: 11px;
      color: #39ff14;
      padding: 10px 0;
      letter-spacing: 1px;
    }

    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 16px;
    }
    .loader-card {
      width: min(420px, 100%);
      background: #121b2f;
      border: 1px solid #243255;
      border-radius: 16px;
      padding: 16px;
      text-align: center;
    }
    .progress-wrap {
      width: 100%;
      background: #0f1730;
      border: 1px solid #2a3a63;
      border-radius: 999px;
      overflow: hidden;
      height: 14px;
    }
    .progress-bar {
      height: 100%;
      width: 0%;
      background: #5b7cfa;
      border-radius: 999px;
      transition: width .12s linear;
    }
    .progress-pct {
      margin-top: 10px;
      font-size: 14px;
      font-weight: 800;
    }

    .rowgap { margin-top: 10px; }
    .hint {
      margin-top: 6px;
      font-size: 12px;
      color: #b9c7ea;
      opacity: .95;
    }
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">

    <div class="logo">
      <h2>WEB CRÃ‰DITO</h2>
      <span>Simulador de EmprÃ©stimo</span>
    </div>

    <!-- CPF -->
    <label>CPF</label>
    <input id="cpf" inputmode="numeric" placeholder="000.000.000-00" maxlength="14" autocomplete="off">
    <div class="warn" id="cpfInfo">Digite seu CPF</div>

    <!-- Nome -->
    <div class="rowgap"></div>
    <label>Nome completo</label>
    <input id="nome" placeholder="Digite seu nome completo" autocomplete="off">
    <div class="hint">Confirme seu nome completo abaixo.</div>

    <!-- Valor -->
    <div class="rowgap"></div>
    <label>Valor desejado (R$)</label>
    <input id="valor" inputmode="numeric" placeholder="Ex: 500" autocomplete="off">
    <div class="warn" id="info">Digite um valor vÃ¡lido</div>

    <!-- Parcelas -->
    <div class="rowgap"></div>
    <label>Parcelas</label>
    <select id="parcelas"></select>

    <button id="btnSimular" onclick="simular()" disabled>Simular</button>

    <div class="result" id="resultado" style="display:none">
      <div class="box">ðŸ’³ Valor da parcela: <strong id="parcela"></strong></div>
      <div class="box">ðŸ“Š Total a pagar: <strong id="total"></strong></div>

      <button class="btn-whatsapp" id="btnWhats" onclick="enviarWhatsComLoading()" disabled>
        Solicitar anÃ¡lise no WhatsApp
      </button>

      <div class="legal">
        SimulaÃ§Ã£o sem compromisso. Valores sujeitos Ã  anÃ¡lise e aprovaÃ§Ã£o.
      </div>
    </div>

  </div>
</div>

<footer>webdev</footer>

<div class="overlay" id="overlay">
  <div class="loader-card">
    <p>Enviando sua solicitaÃ§Ã£oâ€¦</p>
    <div class="progress-wrap">
      <div class="progress-bar" id="progressBar"></div>
    </div>
    <div class="progress-pct" id="progressPct">0%</div>
  </div>
</div>

<script>
  const LIMITE = 1500;
  const WHATSAPP = "5584987974972";

  // ---------- Helpers CPF ----------
  function onlyDigits(s){ return (s || "").replace(/\D/g,""); }

  function maskCPF(digits){
    const d = onlyDigits(digits).slice(0,11);
    let out = "";
    for(let i=0;i<d.length;i++){
      out += d[i];
      if(i===2 || i===5) out += ".";
      if(i===8) out += "-";
    }
    return out;
  }

  function isCPFValid(cpfStr){
    const cpf = onlyDigits(cpfStr);
    if(cpf.length !== 11) return false;
    // bloqueia CPFs repetidos: 000..., 111..., etc.
    if(/^(\d)\1{10}$/.test(cpf)) return false;

    const calc = (base, factorStart) => {
      let sum = 0;
      for(let i=0;i<base.length;i++){
        sum += Number(base[i]) * (factorStart - i);
      }
      const mod = sum % 11;
      return (mod < 2) ? 0 : (11 - mod);
    };

    const d1 = calc(cpf.slice(0,9), 10);
    const d2 = calc(cpf.slice(0,9) + String(d1), 11);
    return cpf.endsWith(String(d1) + String(d2));
  }

  // ---------- Helpers dinheiro ----------
  function parseBRLInteiro(str){
    const d = onlyDigits(str);
    if(!d) return NaN;
    return Number(d);
  }

  function formatarBRL(el){
    const d = onlyDigits(el.value);
    if(!d){ el.value=""; return; }
    el.value = Number(d).toLocaleString("pt-BR",{
      style:"currency", currency:"BRL", minimumFractionDigits:0, maximumFractionDigits:0
    });
  }

  // ---------- Regras e parcela ----------
  function regras(v){
    if(v<=500) return [
      {n:1,t:.25},{n:2,t:.223},{n:3,t:.20},{n:4,t:.195},{n:5,t:.188}
    ];
    if(v<=700) return [{n:6,t:.17},{n:10,t:.164}];
    if(v<=1000) return [{n:6,t:.162},{n:12,t:.154}];
    return [{n:6,t:.161},{n:12,t:.154}];
  }

  function price(p,i,n){
    return p * (i / (1 - Math.pow(1+i,-n)));
  }

  // ---------- Elements ----------
  const elCPF = document.getElementById("cpf");
  const elCPFInfo = document.getElementById("cpfInfo");
  const elNome = document.getElementById("nome");

  const elValor = document.getElementById("valor");
  const elParcelas = document.getElementById("parcelas");
  const elInfo = document.getElementById("info");

  const elBtnSimular = document.getElementById("btnSimular");
  const elResultado = document.getElementById("resultado");
  const elBtnWhats = document.getElementById("btnWhats");

  // ---------- CPF mask + validate ----------
  elCPF.addEventListener("input", () => {
    const caretEnd = elCPF.selectionStart;
    elCPF.value = maskCPF(elCPF.value);
    validarCPF_UI();
    atualizarUI();
    try { elCPF.setSelectionRange(caretEnd, caretEnd); } catch(e){}
  });

  function validarCPF_UI(){
    const cpfOk = isCPFValid(elCPF.value);
    if(!onlyDigits(elCPF.value)){
      elCPFInfo.textContent = "Digite seu CPF";
      elCPFInfo.className = "warn";
      return false;
    }
    if(cpfOk){
      elCPFInfo.textContent = "CPF vÃ¡lido âœ…";
      elCPFInfo.className = "warn ok";
      return true;
    } else {
      elCPFInfo.textContent = "CPF invÃ¡lido. Verifique e tente novamente.";
      elCPFInfo.className = "warn err";
      return false;
    }
  }

  // ---------- Valor formatting ----------
  elValor.addEventListener("input",()=>{
    formatarBRL(elValor);
    atualizarUI();
  });

  // ---------- UI state ----------
  function atualizarUI(){
    const cpfOk = isCPFValid(elCPF.value);
    const nomeOk = elNome.value.trim().length >= 3;

    const v = parseBRLInteiro(elValor.value);

    // reset parcelas/resultado quando mexe
    elParcelas.innerHTML = "";
    elResultado.style.display = "none";
    elBtnWhats.disabled = true;
    window._dados = null;

    elBtnSimular.disabled = true;

    // mensagens valor
    if(!Number.isFinite(v) || v <= 0){
      elInfo.textContent = "Digite um valor vÃ¡lido";
      return;
    }
    if(v > LIMITE){
      elInfo.textContent = "âš ï¸ Valor mÃ¡ximo permitido: R$ 1.500";
      return;
    }

    // preenche parcelas
    regras(v).forEach(r=>{
      const o=document.createElement("option");
      o.value=r.n;
      o.textContent=r.n+"x";
      elParcelas.appendChild(o);
    });

    elInfo.textContent = "Selecione as parcelas";
    // sÃ³ habilita simular se CPF e Nome ok tambÃ©m
    elBtnSimular.disabled = !(cpfOk && nomeOk);
  }

  // Nome muda estado do botÃ£o
  elNome.addEventListener("input", atualizarUI);

  // ---------- Simular ----------
  function simular(){
    const cpfOk = validarCPF_UI();
    const nome = elNome.value.trim();
    const nomeOk = nome.length >= 3;

    const v = parseBRLInteiro(elValor.value);
    const p = Number(elParcelas.value);

    if(!cpfOk){ alert("Informe um CPF vÃ¡lido."); return; }
    if(!nomeOk){ alert("Informe seu nome completo."); return; }

    if(!Number.isFinite(v) || v<=0){ alert("Digite um valor vÃ¡lido."); return; }
    if(v > LIMITE){ alert("âš ï¸ Valor mÃ¡ximo permitido: R$ 1.500"); return; }
    if(!p){ alert("Selecione as parcelas."); return; }

    const r = regras(v).find(x=>x.n===p);
    if(!r){ alert("OpÃ§Ã£o de parcelas invÃ¡lida."); atualizarUI(); return; }

    const parc = price(v, r.t, p);
    const tot = parc * p;

    document.getElementById("parcela").innerText =
      parc.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
    document.getElementById("total").innerText =
      tot.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});

    elResultado.style.display="block";

    window._dados = {
      cpf: elCPF.value,
      nome,
      v,
      p,
      parc,
      tot
    };

    elBtnWhats.disabled = false;
  }

  // ---------- WhatsApp with overlay ----------
  function enviarWhatsComLoading(){
    const d = window._dados;
    if(!d){ alert("FaÃ§a a simulaÃ§Ã£o primeiro."); return; }

    const overlay=document.getElementById("overlay");
    const bar=document.getElementById("progressBar");
    const pct=document.getElementById("progressPct");

    overlay.style.display="flex";
    bar.style.width="0%";
    pct.textContent="0%";

    let prog=0;
    const t=setInterval(()=>{
      prog+=20;
      bar.style.width=prog+"%";
      pct.textContent=prog+"%";
      if(prog>=100){
        clearInterval(t);

        // Emojis por Unicode escape (nÃ£o quebram)
        const msg =
`OlÃ¡! Gostaria de solicitar uma anÃ¡lise de emprÃ©stimo.

ðŸ‘¤ ResponsÃ¡vel: ${d.nome}
ðŸªª CPF: ${d.cpf}

ðŸ’° Valor solicitado: ${d.v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}
ðŸ“† Parcelas: ${d.p}x
ðŸ’³ Valor da parcela: R$ ${d.parc.toFixed(2)}
ðŸ“Š Total a pagar: R$ ${d.tot.toFixed(2)}

Fico no aguardo, obrigado.`;

        // Redirecionamento estÃ¡vel
        window.location.href =
          "https://api.whatsapp.com/send?phone=" + WHATSAPP + "&text=" + encodeURIComponent(msg);

        overlay.style.display="none";
      }
    },80);
  }

  // init
  atualizarUI();
</script>
</body>
</html>
